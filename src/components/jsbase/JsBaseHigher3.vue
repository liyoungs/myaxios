<template>
  <div style="position:relative;">
    <h2>Pomise Òˆ</h2>
    <img :src="keyUrl" alt="Promise preloadImage loadImgAsyc" class="preloadImage" />
    <el-alert type="error" :closable="false" effect="dark">
      <ul slot="title">
        <li>
          ES6 è§„å®šï¼ŒPromise å¯¹è±¡æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ Promise å®ä¾‹ã€‚Promise æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ª
          <i style="color:#303133">å‡½æ•°</i>
          ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ resolve å’Œ reject ã€‚
        </li>
        <li>
          resolve å‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°† Promise å¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œæˆåŠŸâ€ï¼ˆå³ä» pending å˜ä¸º
          resolvedï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ï¼›
        </li>
        <li>
          reject å‡½æ•°çš„ä½œç”¨æ˜¯ ï¼Œå°† Promise å¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œå¤±è´¥â€ï¼ˆå³ä» pending å˜ä¸º
          rejectedï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œæŠ¥å‡ºçš„é”™è¯¯ï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ã€‚
        </li>
        <li>
          Promise å®ä¾‹ç”Ÿæˆä»¥åï¼Œå¯ä»¥ç”¨ then æ–¹æ³•åˆ†åˆ«æŒ‡å®š resolved çŠ¶æ€å’Œ rejected
          çŠ¶æ€çš„å›è°ƒå‡½æ•°ã€‚promise.then(function(value) { /* success */ }, function(error) { /* failure */ });
        </li>
        <li>
          thenæ–¹æ³•å¯ä»¥æ¥å—ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°æ˜¯Promiseå¯¹è±¡çš„çŠ¶æ€å˜ä¸ºresolvedæ—¶è°ƒç”¨ï¼Œç¬¬äºŒä¸ªå›è°ƒå‡½æ•°æ˜¯Promiseå¯¹è±¡çš„çŠ¶æ€å˜ä¸ºrejectedæ—¶è°ƒç”¨ã€‚å…¶ä¸­ï¼Œç¬¬äºŒä¸ªå‡½æ•°æ˜¯å¯é€‰çš„ï¼Œä¸ä¸€å®šè¦æä¾›ã€‚è¿™ä¸¤ä¸ªå‡½æ•°éƒ½æ¥å—Promiseå¯¹è±¡ä¼ å‡ºçš„å€¼ä½œä¸ºå‚æ•°ã€‚
        </li>
        <li>
          Promise å®ä¾‹å…·æœ‰thenæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œthenæ–¹æ³•æ˜¯å®šä¹‰åœ¨åŸå‹å¯¹è±¡Promise.prototypeä¸Šçš„ã€‚å®ƒçš„ä½œç”¨æ˜¯ä¸º
          Promise
          å®ä¾‹æ·»åŠ çŠ¶æ€æ”¹å˜æ—¶çš„å›è°ƒå‡½æ•°ã€‚å‰é¢è¯´è¿‡ï¼Œthenæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯resolvedçŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¯é€‰ï¼‰æ˜¯rejectedçŠ¶æ€çš„å›è°ƒå‡½æ•°ã€‚
          thenæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„Promiseå®ä¾‹ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯åŸæ¥é‚£ä¸ªPromiseå®ä¾‹ï¼‰ã€‚å› æ­¤å¯ä»¥é‡‡ç”¨é“¾å¼å†™æ³•ï¼Œå³thenæ–¹æ³•åé¢å†è°ƒç”¨å¦ä¸€ä¸ªthenæ–¹æ³•ã€‚
        </li>
        <li>
          Promise.prototype.catchæ–¹æ³•æ˜¯.then(null, rejection)æˆ–.then(undefined,
          rejection)çš„åˆ«åï¼Œç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°ã€‚
        </li>
        <li>
          ä¸ç®¡Promiseå®ä¾‹æœ€åçš„çŠ¶æ€ï¼Œåœ¨æ‰§è¡Œå®Œthenæˆ–catchæŒ‡å®šçš„å›è°ƒå‡½æ•°ä»¥åï¼Œéƒ½ä¼šæ‰§è¡Œfinallyæ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚
        </li>
      </ul>
    </el-alert>
    <el-card style="width:720px;margin:auto">
      <el-tag slot="header">å®ä¾‹1 ====> åˆ†æ</el-tag>
      <el-tag type="danger" class="code-wrap">
        const PROMISE = new Promise((resolve, reject) => {
        <br />
        console.log(1);
        <br />
        resolve(2);
        <br />
        console.log(3);
        <br />
        });
        <br />
        PROMISE.then(value => {
        <br />
        console.log("then" + value);
        <br />
        }).catch(error => {
        <br />
        console.log("error" + error);
        <br />
        });
        <br />
        console.log(4);
      </el-tag>
      <el-tag type="danger" class="code-define" style="width:360px">
        æœ¬ä¾‹æ–°å»ºä¸€ä¸ª Promise å®ä¾‹ğŸå¯¹è±¡ ==> PROMISE ï¼Œç”¨ then ã€catch æ–¹æ³•åˆ†åˆ«æŒ‡å®š resolved çŠ¶æ€å’Œ rejected
        çŠ¶æ€çš„å›è°ƒå‡½æ•°ã€‚è¿è¡Œç»“æœï¼š1,3,4,then2; è¿™æ˜¯å› ä¸º Promise æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œé‡Œé¢æœ‰ resolve å’Œ reject
        ä¸¤ä¸ªå¼‚æ­¥äº‹ä»¶ï¼Œåœ¨ PROMISE æ‰§è¡Œä¹‹åï¼Œæ§åˆ¶å°è¾“å‡º1,3,4ã€‚resolveæ‰§è¡Œçš„ç»“æœæœ‰thenæ‰¿æ¥ä¸ºthen2ã€‚
      </el-tag>
    </el-card>
    <el-card style="width:720px;margin:auto">
      <el-tag slot="header">å®ä¾‹2 ====> åˆ†æ</el-tag>
      <el-tag type="danger" class="code-wrap">
        setTimeout(function () {
        <br />
        console.log('three');
        <br />
        }, 0);
        <br />
        <br />
        Promise.resolve().then(function () {
        <br />
        console.log('two');
        <br />
        });
        <br />
        <br />
        console.log('one');
        <br />
        <br />
        // one
        <br />
        // two
        <br />
        // three
      </el-tag>
      <el-tag type="danger" class="code-define">
        ä»£ç ä¸­ï¼Œ setTimeout(fn, 0) åœ¨ä¸‹ä¸€è½® â€œäº‹ä»¶å¾ªç¯â€ å¼€å§‹æ—¶æ‰§è¡Œï¼Œ Promise.resolve() åœ¨æœ¬è½® â€œäº‹ä»¶å¾ªç¯â€
        ç»“æŸæ—¶æ‰§è¡Œï¼Œconsole.log('one') åˆ™æ˜¯ç«‹å³æ‰§è¡Œï¼Œå› æ­¤æœ€å…ˆè¾“å‡ºã€‚
      </el-tag>
    </el-card>
    <el-card style="width:720px;margin:auto">
      <el-tag slot="header">Generator å‡½æ•°çš„è§£æ„èµ‹å€¼</el-tag>
      <img :src="yieldUrl" alt="function* yield" style="width:680px;height:216px" />
      <el-tag type="danger" style="white-space: normal;width:680px;height:auto">
        Generator å‡½æ•°æ˜¯åˆ†æ®µæ‰§è¡Œçš„ï¼Œæ¯æ¬¡è¿”å›éå†å™¨å¯¹è±¡ï¼Œç›´åˆ°é‡åˆ°ä¸€ä¸ª yield è¡¨è¾¾å¼ï¼ˆæˆ– return
        è¯­å¥ï¼‰ä¸ºæ­¢ï¼Œéå†å™¨å¯¹è±¡è‡ªå¸¦ next æ–¹æ³•ã€‚æœ¬ä¾‹ä¸­ä¸º fibs åšä¸€ä¸ªæ•°ç»„çš„è§£æ„èµ‹å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé¦–å…ˆä¸º first
        èµ‹å€¼ï¼Œæ‰§è¡Œåˆ° yield a; ä¸ºæ­¢ï¼Œfirst =>a =>0ã€‚å†ä¸º second èµ‹å€¼ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œ next æ–¹æ³•ã€‚è€Œæ¯æ¬¡è°ƒç”¨ next
        æ–¹æ³•ï¼Œ å†…éƒ¨æŒ‡é’ˆå°±ä»å‡½æ•°å¤´éƒ¨æˆ–ä¸Šä¸€æ¬¡åœä¸‹æ¥çš„åœ°æ–¹å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª yield è¡¨è¾¾å¼ï¼ˆæˆ– return
        è¯­å¥ï¼‰ä¸ºæ­¢ã€‚ æ¢è¨€ä¹‹ï¼Œä¸º second èµ‹å€¼å…ˆæ‰§è¡Œ [a, b] = [b, a + b];å³ a =>b =>1ã€‚ ä¹Ÿå°±æ˜¯ second=>a
        =>1ã€‚ä»¥æ­¤ç±»æ¨ã€‚
      </el-tag>
    </el-card>
  </div>
</template>

<script>
export default {
  name: "JsBaseHigher3",
  data() {
    return {
      keyUrl: require("@/assets/logo.png"),
      yieldUrl: require("@/assets/yield.png")
    };
  },
  methods: {
    loadImgAsyc(url) {
      return new Promise((resolve, reject) => {
        const imgObj = new Image();
        imgObj.onload = resolve;
        imgObj.onerror = reject;
        imgObj.src = url;
      });
    },
    handlePromiseAjax(url) {
      const AJAXOBJ = new Promise((resolve, reject) => {
        const handler = xhr => {
          if (xhr.readyState !== 4) return;
          if (xhr.status === 200) {
            resolve(xhr.response);
          } else {
            reject(new Error(xhr.statusText));
          }
        };
        const CLIENT = new XMLHttpRequest();
        CLIENT.onreadystatechange = handler;
        CLIENT.open("get", url);
        CLIENT.send(null);
      });
      return AJAXOBJ;
    }
  },
  mounted() {
    this.loadImgAsyc(
      "https://images.sftcdn.net/images/t_app-logo-l,f_auto,dpr_auto/p/449d6486-96d2-11e6-b4e2-00163ec9f5fa/2631397628/microsoft-edge-edge%20icon.png"
    )
      .then(img => {
        console.log(img);
        /* eslint-disable dot-notation */
        this.keyUrl = img.path[0].src;
      })
      .catch(err => {
        console.log(err);
      });
    // this.handlePromiseAjax("https://api.apiopen.top/videoHomeTab")
    //   .then(val => {
    //     console.log(val.message);
    //     return val.result;
    //   })
    //   .then(result => {
    //     console.log(result);
    //   })
    //   .catch(err => {
    //     console.log(err);
    //   });
    console.log(" /* eslint-disable no-undef, no-unused-expressions */");

    // fetch("https://raw.githubusercontent.com/DaKoala/fetch-example/master/people.json")
    //   .then(res => res.json())
    //   .then(json => {
    //     console.log(json);
    //     json.forEach(item => {
    //       console.log(item);
    //     });
    //   });
  }
};
</script>

<style>
.code-wrap {
  height: auto;
  line-height: 1.5;
  white-space: normal;
}
.code-define {
  height: auto;
  width: 400px;
  white-space: normal;
  vertical-align: top;
  margin-left: 10px;
}
.preloadImage {
  position: absolute;
  left: 24px;
  top: 288px;
}
.yield {
  position: absolute;
  left: 24px;
  top: 290px;
}
</style>
